{
  "inode": {
    "org": "",
    "id": "cmdb_x-80pgkhago64a",
    "schema_id": "cmdb_schema_x-1dwkbiz80orwl",
    "name": "机柜服务器数量",
    "namespace": "",
    "descr": "auto-test",
    "ctime": 0,
    "mtime": 0,
    "creator": "",
    "last_editor": "",
    "archived": false,
    "lock": ""
  },
  "data": {
    "acquisition_plan": "0 0 * * *",
    "advancement": {
      "script": "function getData() {\n\t// var ctx = new WorkflowRuntimeContext()\n\tvar all_jg_server = []\n\tvar ql = {\n\t\t\"conditions\": [\n\t\t\t{\n\t\t\t\t\"field\": \".inode.schema_id\",\n\t\t\t\t\"op\": \"=\",\n\t\t\t\t\"value\": \"cmdb_schema_x-23k6a3hcq364n\"  //查询机柜模型\n\t\t\t}\n\t\t],\n\t\t\"objects\": [\n\t\t\t\"$conditions\"\n\t\t],\n\t\t\"selects\": [\".inode.id\",\n\t\t\t\"inode.name\"]\n\t}\n\tvar data = ctx.ecu.cmdb.queryObjects(ql).objects\n\n\tvar test = []\n\tdata.forEach(function (item) {\n\t\ttest.push(item.inode.id)          //拿到每个机柜的id\n\t})\n\n\t//ctx.output(test.length)\n\n\ttest.forEach(function (item2) {\n\t\tvar ql_ql = {\n\t\t\t\"conditions\": [\n\t\t\t\t{\n\t\t\t\t\t\"field\": \".inode.schema_id\",\n\t\t\t\t\t\"op\": \"=\",\n\t\t\t\t\t\"value\": \"cmdb_schema_infra_server-0\"          //查询服务器内置\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"field\": \".indexes.cmdb_index-1jdqja4rq8gvu\",   //机柜字段\n\t\t\t\t\t\"op\": \"=\",\n\t\t\t\t\t\"value\": item2\n\t\t\t\t}\n\t\t\t],\n\t\t\t\"objects\": [\n\t\t\t\t\"$conditions\"\n\t\t\t],\n\t\t\t\"selects\": [\n\t\t\t\t\"inode.name\",\n\t\t\t\t\"inode.id\"\n\t\t\t]\n\n\t\t}\n\t\tvar jg_server = ctx.ecu.cmdb.queryObjects(ql_ql).objects\n\t\tvar jg = []\n\t\tjg_server.forEach(function (item) {\n\t\t\tjg.push(item.inode.id)\n\t\t})\n\t\tall_jg_server.push({\n\t\t\t\"jg_id\": item2,\n\t\t\t\"server_count\": jg.length\n\t\t})\n\n\n\t})\n\n\treturn (all_jg_server)\n\n\n}"
    }
  },
  "indexes": {
    "cmdb_index-30aeioiqyk5ux": "高级脚本",
    "cmdb_index-8p5e6iic5hsf": "cmdb_x-2gm02pqt91htp",
    "cmdb_index-ibg1y94vfudg": [
      "cmdb_x-1d2kmgvvheczv"
    ]
  }
}